<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 Updating Data 1.0.0.M1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut Data
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/repositories.html"><strong>3</strong><span>Repository Interfaces</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/querying.html"><strong>4</strong><span>Writing Queries</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/dataUpdates.html"><strong>5</strong><span>Updating Data</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/howItWorks.html"><strong>6</strong><span>How Micronaut Data Works</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/spring.html"><strong>7</strong><span>Spring Data Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/sql.html"><strong>8</strong><span>Micronaut Data with SQL</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/querying.html">&lt;&lt; <strong>4</strong><span>Writing Queries</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/howItWorks.html"><strong>6</strong><span>How Micronaut Data Works</span> >></a></div>
                


                <div class="project">
                    <h1>5 Updating Data</h1>

                    <p><strong>Version:</strong> 1.0.0.M1</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#transactions"><strong>5.1</strong><span>Transactions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#batchUpdates"><strong>5.2</strong><span>Batch Updates</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#batchDeletes"><strong>5.3</strong><span>Batch Deletes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#timestamps"><strong>5.4</strong><span>Entity Timestamps</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="dataUpdates">5 Updating Data</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are various ways to perform write operations with Micronaut Data interfaces.</p>
</div>
<div class="paragraph">
<p>To insert data the simplest form is to define a method that accepts the type of the entity, the same way as the <a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a> interface does:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book persist(Book entity);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book persist(Book entity)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun persist(entity: Book): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method must accept a single argument that is the entity and start with either <code>save</code>, <code>persist</code>, <code>insert</code> or <code>store</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively you can also define a method that features parameter names that match the properties of the entity name:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book persist(String title, int pages);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book persist(String title, int pages)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun persist(title: String, pages: Int): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case you must specify parameters for all properties other than those that are declared as <code>@Nullable</code> or as a <code>@GeneratedValue</code>, if you do not a compilation error will occur.</p>
</div>


<h2 id="transactions">5.1 Transactions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/transactions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data will automatically manage transactions for you. The underlying implementation delegates to the Spring transaction manager, however you can use any of the following annotations to declare your transaction semantics without directly depending on Spring APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javax.transaction.Transactional</code></p>
</li>
<li>
<p><code>org.springframework.transaction.annotation.Transactional</code></p>
</li>
<li>
<p><code>io.micronaut.spring.tx.annotation.Transactional</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut Data maps the declared transaction annotation to the correct underlying semantics and compilation time.</p>
</div>
<div class="paragraph">
<p>Micronaut Data will also automatically apply read-only transactional semantics to query methods and write transaction semantics to write operations.</p>
</div>


<h2 id="batchUpdates">5.2 Batch Updates</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/batchUpdates.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To update an entity you can once again pass the entity to the the <code>save</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book persist(Book entity);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book persist(Book entity)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun persist(entity: Book): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, generally it is more efficient to use batch updates to only update the properties that have actually changed.</p>
</div>
<div class="paragraph">
<p>There are a couple of ways to achieve batch updates. One way is to define a method that features an argument annotated with <a href="../api/io/micronaut/data/annotation/Id.html">@Id</a>, starts with the stem <code>update</code> and returns <code>void</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void update(@Id Long id, int pages);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void update(@Id Long id, int pages)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun update(@Id id: Long?, pages: Int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the ID of the entity will be used to query and perform an update on the entity with all the remaining arguments (in this case <code>pages</code>). If an argument does not match an existing property of the entity a compilation error will occur.</p>
</div>
<div class="paragraph">
<p>Another alternative is to use <code>updateBy*</code> (the method should again return <code>void</code> or a <code>Number</code> indicating the number of records that were updated):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void updateByTitle(String title, int pages);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void updateByTitle(String title, int pages)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun updateByTitle(title: String, pages: Int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case you can use any finder expression to query on arbitrary properties and any remaining arguments that don&#8217;t form part of the query expression are used for the update. Once again if one of the remaining arguments does not match an existing property of the entity a compilation error will occur.</p>
</div>


<h2 id="batchDeletes">5.3 Batch Deletes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/batchDeletes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Batch deletes can be performed in a number of ways. To delete everything (use with care!) you can use <code>deleteAll</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void deleteAll();</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void deleteAll()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">override fun deleteAll()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To delete by ID or by the value of a property you can specify a parameter that matches a property of an entity:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void delete(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void delete(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun delete(title: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, you can also use the <code>deleteBy*</code> pattern (the method must start with <code>delete</code>, <code>remove</code>, <code>erase</code> or <code>eliminate</code>) and any finder expression, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void deleteByTitleLike(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void deleteByTitleLike(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun deleteByTitleLike(title: String)</code></pre>
</div>
</div>


<h2 id="timestamps">5.4 Entity Timestamps</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/timestamps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is common to want to add a field that represents the time when an entity is was first persisted and the time when it was last updated.</p>
</div>
<div class="paragraph">
<p>You can annotate a property that is a date type of an entity with <a href="../api/io/micronaut/data/annotation/DateCreated.html">@DateCreated</a> which will be automatically populated when saving entities and indicates the date a record was created.</p>
</div>
<div class="paragraph">
<p>You can also annotate a property that is a date type of an entity with <a href="../api/io/micronaut/data/annotation/DateUpdated.html">@DateUpdated</a> which will be automatically populated whenever the entity is updated either via the <code>persist</code> method or when using one of the batch update methods of Micronaut Data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you update the entity with an external SQL statement or custom logic you will need to update the underlying <code>DateUpdated</code> column manually.
</td>
</tr>
</table>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/querying.html">&lt;&lt; <strong>4</strong><span>Writing Queries</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/howItWorks.html"><strong>6</strong><span>How Micronaut Data Works</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
